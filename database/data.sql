-- Script d'insertion des données de test
-- Mot de passe pour tous les utilisateurs de test : "123456"
SET client_encoding = 'UTF8';

-- Supprimer les données existantes (dans l'ordre inverse des dépendances)
DELETE FROM notifications;
DELETE FROM task_history;
DELETE FROM tasks;
DELETE FROM project_members;
DELETE FROM projects;
DELETE FROM users;

-- Insertion d'utilisateurs de test pour les User Stories
-- Hash BCrypt pour le mot de passe "123456" : $2a$12$eSKAYweKPUtN4lS4xyYKJ.rgToxyQm2VuzBJudLEWYhWGe3YD072u
INSERT INTO users (id, user_name, email, password) VALUES
-- Utilisateurs principaux pour tester les US
('10000000-0000-0000-0000-000000000001', 'admin', 'admin@gmail.com', '$2a$12$eSKAYweKPUtN4lS4xyYKJ.rgToxyQm2VuzBJudLEWYhWGe3YD072u'),
('10000000-0000-0000-0000-000000000002', 'member', 'member@gmail.com', '$2a$12$eSKAYweKPUtN4lS4xyYKJ.rgToxyQm2VuzBJudLEWYhWGe3YD072u'),
-- Utilisateurs supplémentaires pour les tests
('10000000-0000-0000-0000-000000000003', 'john.doe', 'john.doe@example.com', '$2a$12$eSKAYweKPUtN4lS4xyYKJ.rgToxyQm2VuzBJudLEWYhWGe3YD072u'),
('10000000-0000-0000-0000-000000000004', 'jane.smith', 'jane.smith@example.com', '$2a$12$eSKAYweKPUtN4lS4xyYKJ.rgToxyQm2VuzBJudLEWYhWGe3YD072u'),
('10000000-0000-0000-0000-000000000005', 'bob.johnson', 'bob.johnson@example.com', '$2a$12$eSKAYweKPUtN4lS4xyYKJ.rgToxyQm2VuzBJudLEWYhWGe3YD072u');

-- Insertion de projets de test avec dates de début
INSERT INTO projects (id, name, description, starting_date) VALUES
-- Projet principal pour tester les US (avec admin et member)
('20000000-0000-0000-0000-000000000001', 'Projet de Test US', 'Projet de test pour valider toutes les User Stories', CURRENT_DATE - INTERVAL '10 days'),
-- Projets supplémentaires
('20000000-0000-0000-0000-000000000002', 'Application Web E-commerce', 'Développement d''une application web e-commerce avec Angular et Spring Boot', CURRENT_DATE - INTERVAL '20 days'),
('20000000-0000-0000-0000-000000000003', 'Système de Gestion de Projets', 'Application de gestion de projets avec suivi des tâches', CURRENT_DATE + INTERVAL '5 days'),
('20000000-0000-0000-0000-000000000004', 'API REST pour Mobile', 'Développement d''une API REST pour application mobile', CURRENT_DATE - INTERVAL '15 days'),
('20000000-0000-0000-0000-000000000005', 'Site Vitrine Entreprise', 'Création d''un site vitrine pour présenter l''entreprise', CURRENT_DATE - INTERVAL '40 days');

-- Insertion de membres dans les projets avec rôles
-- Projet principal de test : admin est ADMIN, member est MEMBER
INSERT INTO project_members (project_id, user_id, role) VALUES
-- Projet de Test US (20000000-0000-0000-0000-000000000001)
('20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', 'ADMIN'),
('20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000002', 'MEMBER'),
-- Projets supplémentaires
('20000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000003', 'ADMIN'),
('20000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000004', 'MEMBER'),
('20000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000005', 'MEMBER'),
('20000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000001', 'ADMIN'),
('20000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000002', 'MEMBER'),
('20000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000003', 'ADMIN'),
('20000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000004', 'MEMBER'),
('20000000-0000-0000-0000-000000000005', '10000000-0000-0000-0000-000000000001', 'ADMIN'),
('20000000-0000-0000-0000-000000000005', '10000000-0000-0000-0000-000000000002', 'MEMBER');

-- Insertion de tâches de test avec dates de fin pour certaines
-- Tâches pour le projet de test principal (20000000-0000-0000-0000-000000000001)
INSERT INTO tasks (id, project_member_project_id, project_member_user_id, name, description, status, priority, due_date, end_date) VALUES
-- Tâches assignées à l'admin (pour tester l'assignation)
('30000000-0000-0000-0000-000000000001', '20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', 'Tâche assignée à Admin', 'Cette tâche est assignée à l''administrateur du projet', 'TODO', 'HIGH', CURRENT_DATE + INTERVAL '5 days', NULL),
('30000000-0000-0000-0000-000000000002', '20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', 'Tâche en cours - Admin', 'Tâche en cours de développement par l''admin', 'IN_PROGRESS', 'MEDIUM', CURRENT_DATE + INTERVAL '3 days', NULL),
-- Tâche assignée au member (pour tester l'assignation)
('30000000-0000-0000-0000-000000000003', '20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000002', 'Tâche assignée à Member', 'Cette tâche est assignée au membre du projet', 'TODO', 'MEDIUM', CURRENT_DATE + INTERVAL '7 days', NULL),
-- Tâche terminée
('30000000-0000-0000-0000-000000000004', '20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', 'Tâche terminée', 'Tâche déjà complétée pour tester l''historique', 'DONE', 'LOW', CURRENT_DATE - INTERVAL '5 days', CURRENT_DATE - INTERVAL '2 days'),
-- Tâches supplémentaires pour les autres projets
('30000000-0000-0000-0000-000000000005', '20000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000003', 'Conception de la base de données', 'Créer le schéma de la base de données avec toutes les tables nécessaires', 'DONE', 'HIGH', CURRENT_DATE - INTERVAL '15 days', CURRENT_DATE - INTERVAL '12 days'),
('30000000-0000-0000-0000-000000000006', '20000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000003', 'Développement du backend Spring Boot', 'Implémenter les contrôleurs et services pour les utilisateurs et projets', 'IN_PROGRESS', 'HIGH', CURRENT_DATE + INTERVAL '5 days', NULL),
('30000000-0000-0000-0000-000000000007', '20000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000001', 'Analyse des besoins', 'Analyser et documenter les besoins du projet', 'DONE', 'HIGH', CURRENT_DATE - INTERVAL '8 days', CURRENT_DATE - INTERVAL '5 days'),
('30000000-0000-0000-0000-000000000008', '20000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000002', 'Architecture technique', 'Définir l''architecture technique de l''application', 'IN_PROGRESS', 'HIGH', CURRENT_DATE + INTERVAL '2 days', NULL),
('30000000-0000-0000-0000-000000000009', '20000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000003', 'Développement API REST', 'Créer les endpoints REST pour les ressources principales', 'IN_PROGRESS', 'HIGH', CURRENT_DATE + INTERVAL '5 days', NULL),
('30000000-0000-0000-0000-000000000010', '20000000-0000-0000-0000-000000000005', '10000000-0000-0000-0000-000000000001', 'Design de la page d''accueil', 'Créer le design de la page d''accueil du site', 'DONE', 'LOW', CURRENT_DATE - INTERVAL '35 days', CURRENT_DATE - INTERVAL '30 days');

-- Insertion d'historique des modifications de tâches
INSERT INTO task_history (id, task_id, project_member_project_id, project_member_user_id, field_name, old_value, new_value, modified_at) VALUES
-- Historique pour les tâches du projet de test
('40000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000001', '20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', 'name', NULL, 'Tâche assignée à Admin', CURRENT_TIMESTAMP - INTERVAL '8 days'),
('40000000-0000-0000-0000-000000000002', '30000000-0000-0000-0000-000000000002', '20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', 'status', 'TODO', 'IN_PROGRESS', CURRENT_TIMESTAMP - INTERVAL '5 days'),
('40000000-0000-0000-0000-000000000003', '30000000-0000-0000-0000-000000000003', '20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', 'name', NULL, 'Tâche assignée à Member', CURRENT_TIMESTAMP - INTERVAL '6 days'),
('40000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000004', '20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', 'status', 'IN_PROGRESS', 'DONE', CURRENT_TIMESTAMP - INTERVAL '2 days'),
('40000000-0000-0000-0000-000000000005', '30000000-0000-0000-0000-000000000004', '20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', 'endDate', NULL, (CURRENT_DATE - INTERVAL '2 days')::text, CURRENT_TIMESTAMP - INTERVAL '2 days'),
-- Historique pour les autres projets
('40000000-0000-0000-0000-000000000006', '30000000-0000-0000-0000-000000000005', '20000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000003', 'status', 'TODO', 'IN_PROGRESS', CURRENT_TIMESTAMP - INTERVAL '16 days'),
('40000000-0000-0000-0000-000000000007', '30000000-0000-0000-0000-000000000005', '20000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000003', 'status', 'IN_PROGRESS', 'DONE', CURRENT_TIMESTAMP - INTERVAL '12 days'),
('40000000-0000-0000-0000-000000000008', '30000000-0000-0000-0000-000000000006', '20000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000003', 'status', 'TODO', 'IN_PROGRESS', CURRENT_TIMESTAMP - INTERVAL '13 days'),
('40000000-0000-0000-0000-000000000009', '30000000-0000-0000-0000-000000000007', '20000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000001', 'status', 'IN_PROGRESS', 'DONE', CURRENT_TIMESTAMP - INTERVAL '5 days'),
('40000000-0000-0000-0000-000000000010', '30000000-0000-0000-0000-000000000008', '20000000-0000-0000-0000-000000000003', '10000000-0000-0000-0000-000000000002', 'status', 'TODO', 'IN_PROGRESS', CURRENT_TIMESTAMP - INTERVAL '6 days'),
('40000000-0000-0000-0000-000000000011', '30000000-0000-0000-0000-000000000009', '20000000-0000-0000-0000-000000000004', '10000000-0000-0000-0000-000000000003', 'status', 'TODO', 'IN_PROGRESS', CURRENT_TIMESTAMP - INTERVAL '10 days'),
('40000000-0000-0000-0000-000000000012', '30000000-0000-0000-0000-000000000010', '20000000-0000-0000-0000-000000000005', '10000000-0000-0000-0000-000000000001', 'status', 'IN_PROGRESS', 'DONE', CURRENT_TIMESTAMP - INTERVAL '30 days');

-- Insertion de notifications de test
INSERT INTO notifications (id, project_member_project_id, project_member_user_id, task_id, message, created_at, is_read) VALUES
('50000000-0000-0000-0000-000000000001', '20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004', 'La tâche "Tâche terminée" a été complétée', CURRENT_TIMESTAMP - INTERVAL '2 days', true),
('50000000-0000-0000-0000-000000000002', '20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000002', 'La tâche "Tâche en cours - Admin" est en cours', CURRENT_TIMESTAMP - INTERVAL '5 days', true),
('50000000-0000-0000-0000-000000000003', '20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000002', '30000000-0000-0000-0000-000000000003', 'La tâche "Tâche assignée à Member" vous a été assignée', CURRENT_TIMESTAMP - INTERVAL '6 days', false),
('50000000-0000-0000-0000-000000000004', '20000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000003', '30000000-0000-0000-0000-000000000005', 'La tâche "Conception de la base de données" a été complétée', CURRENT_TIMESTAMP - INTERVAL '12 days', true);
